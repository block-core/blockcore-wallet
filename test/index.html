<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Blockcore Provider - Sample Web Page</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <link rel="icon" type="image/x-icon" href="favicon.ico"> -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <style>
      #blockcore-extension-input {
        width: 400px;
        height: 200px;
      }

      #blockcore-extension-output {
        border: 1px solid gray;
        padding: 3em;
        margin: 1em;
      }
    </style>
  </head>

  <body>
    <h1>Blockcore Provider - Sample Web Page</h1>

    <textarea id="blockcore-extension-input">
{
        "id": "123",
        "identity": "I am who I am."
}</textarea
    >
    <br /><br />
    <!-- <button class="blockcore-extension-button" purpose="login">Click to login with Blockcore</button>
    <button class="blockcore-extension-button" purpose="sign">Click to sign with Blockcore</button>
    <button class="blockcore-extension-button" purpose="identity">Click to give identity with Blockcore</button> -->

    <br />
    <button id="connectButton">Ask for Public Key</button>
    <button id="connectButton2">Ask for Signing</button>

    <br />
    <div id="blockcore-extension-output"></div>

    <!-- <button id="blockcore-extension-button" purpose="signing">Sign with Blockcore</button> -->

    <!-- <button onclick="connect();">Click to sign</button> with Blockcore Wallet. -->

    <script>
      function connectRefactor() {
        console.log("Attempting to connect with Blockcore Wallet...");

        // console.log(window.blockcore2);

        if (!window.blockcore) {
          alert("The Blockcore Provider has not loaded.");
        } else {
          var provider = window.blockcore;

          window.blockcore.open();

          // Subscribe to accounts change
          provider.on("accountsChanged", (accounts) => {
            console.log(accounts);
          });

          // Subscribe to chainId change
          provider.on("networkChanged", (chainId) => {
            console.log(chainId);
          });

          // Subscribe to session disconnection
          provider.on("disconnect", (code, reason) => {
            console.log(code, reason);
          });

          // Open the UI:
          // provider.open();

          // console.log(provider);
          // const accounts = provider.getAccounts();
        }
      }
    </script>

    <script>
      async function connect() {
        document.getElementById("blockcore-extension-output").innerText = "";

        const blockcore = globalThis.blockcore;

        if (!blockcore) {
          alert("The Blockcore provider is not available. Unable to continue.");
          return;
        }

        let pubKey;

        try {
          pubKey = await window.blockcore.publicKey();
        } catch (err) {
          console.error(err);
          pubKey = "Error: " + err.message;
        }

        document.getElementById("blockcore-extension-output").innerText = pubKey;
      }

      async function connect2() {
        document.getElementById("blockcore-extension-output").innerText = "";

        const blockcore = globalThis.blockcore;

        if (!blockcore) {
          alert("The Blockcore provider is not available. Unable to continue.");
          return;
        }

        let signature;

        try {
          signature = await window.blockcore.sign("data");
        } catch (err) {
          console.error(err);
          signature = "Error: " + err.message;
        }

        document.getElementById("blockcore-extension-output").innerText = signature;
      }

      (function () {
        // Examples of wiring up click handler:
        // document.getElementById("connectButton").onclick = connect;
        document.getElementById("connectButton").addEventListener("click", connect);
        document.getElementById("connectButton2").addEventListener("click", connect2);
      })();
    </script>
  </body>
</html>
